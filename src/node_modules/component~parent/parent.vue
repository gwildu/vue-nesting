<style lang="less">

</style>

<template>

  <div class="parent">
    <ul>
      <li v-for="kid in kids" >
        <r-child :list-id="$index" :factor="kid.factor" @value-changed="childUpdated" :some-number="kid.someNumber"></r-child><button @click="this.delete($index)">&times;</button>
      </li>

      <r-child v-if="!otherKid.disabled" v-ref:otherkid :list-id="3" :factor="otherKid.factor" :some-number="otherKid.someNumber" @value-changed="childUpdated" :disabled="otherKid.disabled"></r-child><button v-if="!otherKid.disabled" @click="this.delete(3)">&times;</button>
    </ul>
    <p>
      I'm the parent. <br />
      The sum of all my kids random numbers is: {{sum.random}}<br />
      The sum of all my kids someNumbers is: {{sum.someNumber}}<br/>
      <button @click="updateAll">update all kids</button>
      <button @click="updateSomeNumbers">update sumNumbers only</button>
    </p>
  </div>

</template>

<script>

  var
      child = require('element~child');

  module.exports = {
    components: {
      'r-child': child
    },
    data: function(){
      return {
        kids: [
          {factor: 10, someNumber: 0},
          {factor: 575, someNumber: 0},
          {factor: 37, someNumber: 0}
        ],
        otherKid: {
          factor: 55,
          someNumber: 0,
          disabled: false
        }
      }
    },
//    mounted: function() {
//      for (var i = 0; i < this.$children.length; i++){
//        this.$children[i].disabled = false;
//      }
//    },
    computed: {
      sum: function(){
        var result = {
          random: 0,
          someNumber: 0
        };
        for(var i = 0; i < this.$children.length; i++) {
          result.random += this.$children[i].value;
          result.someNumber += this.$children[i].someNumber;
          console.log(this.$children[i].value);
        }
        return result;
      },
      sumSomeNumbers: function() {
        var result = 0;
        for (var i = 0; i < this.$children.length; i++) {}
      }
    },
    methods: {
      childUpdated(index, value, someNumber){
        if (index < 3) {
          this.kids[index].someNumber = someNumber;
        } else {
          this.otherKid.someNumber = someNumber;
        }
      },
      updateAll() {
        console.log(this.$refs.child);
        for (var i = 0; i < this.$children.length; i++) {
          this.$children[i].update();
        }
      },
      updateSomeNumbers() {
        for (var i = 0; i < this.kids.length; i++) {
          this.kids[i].someNumber++;
        }
        this.otherKid.someNumber++;
      },
      delete(index) {
        console.log('index: ' + index, 'length: ' + this.kids.length, this.$refs.otherkid);
        if(this.kids.length > index) {
          this.kids.splice(index, 1);
        } else {
          this.otherKid.disabled = true;
          //this.$refs.otherkid.$remove();
          //this.$refs.otherkid.$destroy();

        }

        console.log(this.$refs.otherkid);

      }
    }
  };

</script>